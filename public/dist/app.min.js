angular.module("orangeWalrus.factories",[]).factory("Activities",function($http){return{getActivities:function(){return $http({method:"GET",url:"api/activities"})},addActivity:function(activity){return $http({method:"POST",url:"api/activities",data:activity,dataType:"json"})},getActivity:function(activity_id){return $http({method:"GET",url:"api/activity/"+activity_id})},updateActivity:function(activity){return $http({method:"PUT",url:"api/activity/"+activity._id,data:activity,dataType:"json"})},deleteActivity:function(activity_id){return $http({method:"DELETE",url:"api/activity/"+activity_id})}}}),angular.module("orangeWalrus.activities",[]).controller("ActivitiesController",function($scope,Activities){$scope.data={},Activities.getActivities().then(function(response){$scope.data.activities=response.data}).catch(function(err){console.log(err)})}).controller("ActivityController",function($scope,$location,$stateParams,Activities){Activities.getActivity($stateParams.activity_id).then(function(response){$scope.activity=response.data}).catch(function(err){console.log(err)}),$scope.deleteActivity=function(){Activities.deleteActivity($scope.activity._id).then(function(){console.log("Activity deleted"),$location.path("/activities")}).catch(function(err){console.log(err)})},$scope.clicked=function(attr){console.log(attr)}}).controller("ActivityFormController",function($scope,$location,$stateParams,Activities){$stateParams.activity_id?($scope.edit=!0,Activities.getActivity($stateParams.activity_id).then(function(response){$scope.activity=response.data}).catch(function(err){console.log(err)})):$scope.activity={},void 0===$scope.activity.tags&&($scope.activity.tags=[]),$scope.saveActivity=function(){$scope.edit?Activities.updateActivity($scope.activity).then(function(response){console.log("Activity updated"),$location.path("/activity/"+response.data.activity_id)}).catch(function(err){console.log(err)}):Activities.addActivity($scope.activity).then(function(response){console.log("Activity updated"),$location.path("/activity/"+response.data.activity_id)}).catch(function(err){console.log(err)})},$scope.addTag=function(){""!==$scope.tag&&-1===$scope.activity.tags.indexOf($scope.tag)&&$scope.activity.tags.unshift($scope.tag),$scope.tag=""},$scope.removeTag=function(tag){var i=$scope.activity.tags.indexOf(tag);i>=0&&$scope.activity.tags.splice(i,1)}}).directive("ngActivityLink",function(){return{restrict:"E",templateUrl:"/app/activities/activityLink.html"}});var app=angular.module("orangeWalrus",["orangeWalrus.factories","orangeWalrus.activities","ui.router"]);app.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/activities"),$stateProvider.state("listActivities",{url:"/activities",templateUrl:"app/activities/activities.html",controller:"ActivitiesController"}).state("showActivity",{url:"/activity/:activity_id",templateUrl:"/app/activities/activity.html",controller:"ActivityController"}).state("editActivity",{url:"/activity/:activity_id/edit",templateUrl:"/app/activities/activityForm.html",controller:"ActivityFormController"}).state("newActivity",{url:"/activities/new",templateUrl:"/app/activities/activityForm.html",controller:"ActivityFormController"})});